(()=>{"use strict";const t=new class{constructor(){this.storage={board:document.querySelector(".board"),playButton:document.querySelector(".play-btn"),score:document.querySelector(".score__text"),food:document.querySelector(".food")}}};const e=new class{constructor(){this.el=t.storage.playButton}enable(){this.el.disabled=!1,this.el.style.visibility="visible"}disable(){this.el.disabled=!0,this.el.style.visibility="hidden"}};const s=new class{constructor(){this.el=t.storage.board,this.inner=this.el.querySelector(".board__inner")}};const o=new class{constructor(){this.speed=5,this.direction=null,this.coords=[{x:20,y:10}]}createNewSnake(){const t=this.coords[this.coords.length-1];let e;switch(this.direction){case"up":e={x:t.x,y:t.y+1};break;case"down":e={x:t.x,y:t.y-1};break;case"left":e={x:t.x+1,y:t.y};break;case"right":e={x:t.x-1,y:t.y}}this.coords.push(e);const o=document.createElement("div");o.classList.add("snake"),o.style.gridRowStart=e.y,o.style.gridColumnStart=e.x;const i=document.createElement("div");i.classList.add("snake__inner"),o.appendChild(i),s.inner.appendChild(o)}updateSnakePosition(){const t=document.querySelectorAll(".snake"),e=t[0];for(let e=this.coords.length-1;e>=1&&1!==this.coords.length;e--)this.coords[e]={...this.coords[e-1]},t[e].style.gridRowStart=this.coords[e].y,t[e].style.gridColumnStart=this.coords[e].x;switch(this.direction){case"up":this.coords[0].y=this.coords[0].y-1;break;case"down":this.coords[0].y=this.coords[0].y+1;break;case"left":this.coords[0].x=this.coords[0].x-1;break;case"right":this.coords[0].x=this.coords[0].x+1}e.style.gridRowStart=this.coords[0].y,e.style.gridColumnStart=this.coords[0].x}checkCollisionWithSelf(){if(1!==this.coords.length)for(let t=1;t<this.coords.length;t++)if(Math.abs(this.coords[t].x-this.coords[0].x)<1&&this.coords[t].y-this.coords[0].y==0||Math.abs(this.coords[t].y-this.coords[0].y)<1&&this.coords[t].x-this.coords[0].x==0)return!0}checkCollisionWithWall(){const t=this.coords[0].x,e=this.coords[0].y;if(t>=40||t<=0||e>=20||e<=0)return!0}removeSnake(){const t=document.querySelectorAll(".snake"),e=t.length-1;t.forEach(((t,o)=>{0!==o&&setTimeout((()=>s.inner.removeChild(t)),250*(e-o))})),this.direction=null,this.coords=[{x:20,y:10}]}};const i=new class{constructor(){this.el=t.storage.score,this.scoreText="Score:",this.scoreCount=0}inc(){this.scoreCount+=10}update(){this.el.textContent=`${this.scoreText} ${this.scoreCount}`}reset(){this.scoreCount=0,this.update()}},r=(t,e)=>(t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t));const c=new class{constructor(){this.x=null,this.y=null,this.el=t.storage.food}getNewCoords(){let t=0,e=0;do{t=r(3,35),e=r(3,15)}while(this.checkFoodCoords(this.x,this.y));this.x=t,this.y=e,null!==this.el?(this.hideFood(),setTimeout((()=>this.changeCoords()),1e3)):this.createFood()}changeCoords(){this.el.style.gridRowStart=this.y,this.el.style.gridColumnStart=this.x,this.showFood()}checkFoodCoords(t,e){o.coords.forEach((s=>{if(t===s.x&&e===s.y)return!0}))}checkCollisionWithSnake(){const t=o.coords[0].x,e=o.coords[0].y;(Math.abs(this.x-t)<1&&0===Math.abs(this.y-e)||Math.abs(this.y-e)<1&&0===Math.abs(this.x-t))&&(i.inc(),i.update(),this.getNewCoords(),o.createNewSnake())}showFood(){this.el.style.visibility="visible"}hideFood(){this.el.style.visibility="hidden"}},n=new Audio;n.loop=!0,n.src="./files/music.mp3";const d=n;function h(t){if(o.checkCollisionWithSelf()||o.checkCollisionWithWall())return void l.endGame();window.requestAnimationFrame(h);(t-l.lastRenderTime)/1e3<1/o.speed||(l.lastRenderTime=t,o.updateSnakePosition(),c.checkCollisionWithSnake())}const l=new class{constructor(){this.lastRenderTime=0}startGame(){d.play(),e.disable(),c.getNewCoords(),h()}endGame(){d.pause(),d.currentTime=0,this.lastRenderTime=0,e.enable(),c.hideFood(),o.removeSnake(),i.reset()}},a=l,u=t=>{switch(t.keyCode){case 38:"down"!==o.direction&&(o.direction="up");break;case 40:"up"!==o.direction&&(o.direction="down");break;case 37:"right"!==o.direction&&(o.direction="left");break;case 39:"left"!==o.direction&&(o.direction="right")}};window.addEventListener("DOMContentLoaded",(()=>{e.el.addEventListener("click",(()=>a.startGame())),window.addEventListener("keydown",u)}))})();